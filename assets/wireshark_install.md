# Instalaci√≥n de Wireshark

1. **Actualizar repositorios**

   ```bash
   sudo apt update
   ```

2. **Instalar el paquete**

   ```bash
   sudo apt install wireshark
   ```

3. **Permitir capturas sin privilegios root**
   Durante la instalaci√≥n, te preguntar√° si los usuarios no-root pueden capturar paquetes. Selecciona **S√≠**.
   Si no lo hiciste entonces, ejecuta:

   ```bash
   sudo dpkg-reconfigure wireshark-common
   ```

   Marca **Yes** cuando pregunte.

4. **Agregar tu usuario al grupo `wireshark`**

   ```bash
   sudo usermod -aG wireshark $USER
   ```

   Luego, cierra sesi√≥n y vuelve a iniciarla (o reinicia) para que el cambio surta efecto.

---

## Verificar instalaci√≥n y permisos

1. Comprueba que Wireshark est√° instalado:

   ```bash
   wireshark --version
   ```

   Debe salir algo como `Wireshark 4.x.x (v4.x.x-release)`.

2. Verifica que puedas listar las interfaces de red sin sudo:

   ```bash
   tshark -D
   ```

   Debe mostrar una lista de interfaces (por ejemplo `1. eth0`, `2. wlan0`, ‚Ä¶).

---

## Captura b√°sica con interfaz gr√°fica

1. **Inicia Wireshark**
   Desde el men√∫ de aplicaciones o:

   ```bash
   wireshark &
   ```

2. **Selecciona la interfaz**
   En la ventana principal ver√°s todas las interfaces activas. Haz doble clic sobre la que quieras monitorear (por ejemplo `eth0` o `wlan0`).

3. **Iniciar captura**
   Se abrir√° la vista de paquetes en tiempo real. Para detenerla, haz clic en el bot√≥n rojo ‚ñ† (Stop).

4. **Guardar captura**
   Ve a **File ‚Üí Save As‚Ä¶** y elige un nombre, por ejemplo `captura.pcapng`.

---

## Ejemplo pr√°ctico: analizar tr√°fico HTTP

Supongamos que quieres capturar y analizar peticiones HTTP a un servidor web local.

1. **Generar tr√°fico HTTP**
   En otra terminal:

   ```bash
   curl http://example.com/
   ```

2. **Aplicar filtro de visualizaci√≥n**
   En la caja de filtros de Wireshark, escribe:

   ```
   http.request
   ```

   y presiona Enter. As√≠ ver√°s s√≥lo los paquetes que contienen peticiones HTTP.

3. **Inspeccionar un paquete**

   * Haz clic en un paquete de tipo `GET / HTTP/1.1`.
   * En el panel intermedio ver√°s la jerarqu√≠a de protocolos: Ethernet ‚Üí IP ‚Üí TCP ‚Üí HTTP.
   * Expande **Hypertext Transfer Protocol** para leer encabezados como `Host: example.com`, `User-Agent: ‚Ä¶`, etc.

4. **Seguir el flujo TCP**
   Con un paquete HTTP seleccionado, haz clic derecho ‚Üí **Follow ‚Üí TCP Stream**.
   Ver√°s la conversaci√≥n completa de solicitud y respuesta en texto plano.

---

## Uso de filtros avanzados

* **Filtrar por direcci√≥n IP**

  ```
  ip.addr == 192.168.1.100  
  ```
* **Ver solo paquetes DNS**

  ```
  dns
  ```
* **Capturar s√≥lo TCP en la interfaz (filtro de captura)**
  En ‚ÄúCapture ‚Üí Options‚Äù pon en *Capture filter*:

  ```
  tcp
  ```
* **Mostrar paquetes TLS (HTTPS)**

  ```
  tls
  ```

---

## Captura y an√°lisis desde l√≠nea de comandos

1. **Capturar con `tshark`**

   ```bash
   tshark -i wlan0 -f "port 80" -w http_only.pcapng
   ```

   * `-i wlan0`: interfaz
   * `-f "port 80"`: filtro de captura BPF (solo puerto 80)
   * `-w`: escribir a archivo

2. **Leer y filtrar**

   ```bash
   tshark -r http_only.pcapng -Y "http.request" -V
   ```

   * `-r`: leer captura
   * `-Y`: filtro de visualizaci√≥n
   * `-V`: modo verboso (desglosa cada campo)

---

¬°Perfecto, Shamara! üöÄ Te prepar√© un **Cheat Sheet de Wireshark** con los comandos y filtros m√°s usados para an√°lisis de tr√°fico de red. Lo divid√≠ en secciones pr√°cticas para que sea f√°cil de consultar.

---

# Wireshark Cheat Sheet

## Comandos b√°sicos en terminal (Linux)

* **Capturar tr√°fico en interfaz espec√≠fica:**

  ```bash
  sudo wireshark -i eth0
  ```

* **Listar interfaces disponibles:**

  ```bash
  tshark -D
  ```

* **Captura con `tshark` (modo CLI):**

  ```bash
  tshark -i wlan0 -c 100
  ```

  (captura 100 paquetes en wlan0)

* **Guardar captura:**

  ```bash
  tshark -i eth0 -w captura.pcap
  ```

* **Leer archivo `.pcap`:**

  ```bash
  wireshark captura.pcap
  ```

---

## Filtros de captura (aplicados **antes** de capturar)

(Sintaxis tipo `tcpdump`)

* **Host espec√≠fico:**
  `host 192.168.1.10`
* **Red completa:**
  `net 192.168.1.0/24`
* **Protocolo:**
  `tcp` | `udp` | `icmp`
* **Puerto:**
  `port 80`
* **IP origen/destino:**
  `src host 10.0.0.1`
  `dst host 8.8.8.8`
* **Combinaciones:**
  `tcp port 443 and host 8.8.8.8`

---

## Filtros de visualizaci√≥n (aplicados **despu√©s** de capturar)

(Sintaxis propia de Wireshark)

### Protocolo

* `http` ‚Üí Solo tr√°fico HTTP
* `dns` ‚Üí Consultas DNS
* `icmp` ‚Üí Pings y mensajes ICMP

### IP

* `ip.addr == 192.168.1.5` ‚Üí Cualquier tr√°fico de esa IP
* `ip.src == 10.0.0.1` ‚Üí IP origen
* `ip.dst == 8.8.8.8` ‚Üí IP destino
* `ip.addr == 192.168.1.5 && tcp.port == 443`

### Puertos

* `tcp.port == 80`
* `udp.port == 53`

### Contenido

* `http.request` ‚Üí Solo peticiones HTTP
* `http.response.code == 200` ‚Üí Respuestas HTTP 200 OK
* `frame contains "password"` ‚Üí Paquetes que contienen la palabra "password"

### Combinaciones

* `ip.src == 192.168.1.5 && tcp.port == 443`
* `(http || dns) && ip.addr == 192.168.1.5`

---

## Atajos √∫tiles en interfaz Wireshark

* **Ctrl + E** ‚Üí Iniciar/detener captura
* **Ctrl + K** ‚Üí Aplicar filtro
* **Ctrl + Shift + F** ‚Üí Buscar dentro de paquetes
* **Ctrl + Shift + P** ‚Üí Estad√≠sticas de protocolo
* **Ctrl + H** ‚Üí Seguir flujo TCP

---

## Estad√≠sticas r√°pidas

* **Estad√≠sticas ‚Üí Protocol Hierarchy** ‚Üí Uso de protocolos
* **Estad√≠sticas ‚Üí Conversations** ‚Üí Conversaciones por IP
* **Estad√≠sticas ‚Üí Endpoints** ‚Üí Tr√°fico por dispositivo

---

### `androiddump` 
Extcap que permite capturar tr√°fico desde dispositivos Android conectados mediante **ADB (Android Debug Bridge)**.
Requiere tener instalado el **SDK de Android**. Muy √∫til para analizar tr√°fico en apps m√≥viles.

---
### `capinfos`
Muestra informaci√≥n detallada de archivos de captura (`.pcap`, `.pcapng`).
Ejemplo de datos: n√∫mero de paquetes, tama√±o del archivo, duraci√≥n de la captura, timestamps, hashes MD5/SHA, etc.
Se usa para obtener estad√≠sticas r√°pidas sin abrir Wireshark.

---

### `captype`
Identifica y muestra el **tipo de archivo de captura** (formato soportado por Wireshark).
Ejemplo: pcap, pcapng, etc. √ötil cuando no se conoce el origen de un archivo.

---

### `ciscodump`
Extcap que permite capturar tr√°fico directamente desde un dispositivo **Cisco** remoto (IOS, IOS-XE, ASA, EPC) mediante **SSH**.
Muy usado por administradores de red para depuraci√≥n remota.

---

### `dumpcap`
Herramienta ligera dedicada √∫nicamente a **capturar tr√°fico** de red y guardarlo en un archivo.
Wireshark y TShark la usan internamente. Soporta privilegios elevados y rotaci√≥n de archivos para capturas largas.

---

### `editcap`
Permite **editar y/o convertir archivos de captura**.
Funciones: eliminar paquetes, cortar rangos de tiempo, extraer subconjuntos, cambiar formato (pcap ‚Üî pcapng), anonimizar datos.

---

### `etwdump`
Extcap que habilita la captura desde **Event Tracing for Windows (ETW)**, una infraestructura de logging de bajo nivel de Windows.
Se usa para correlacionar eventos del sistema operativo con tr√°fico de red.

---

### `extcap`
Interfaz que permite integrar **herramientas externas** como si fueran interfaces nativas en Wireshark.
Ejemplos: androiddump, ciscodump, wifidump, etwdump.

---

### `falcodump`
Extcap que conecta con **Falco**, un motor de seguridad basado en eBPF/Sysdig, y vuelca los logs como si fueran paquetes capturados.
Ideal para an√°lisis de eventos de seguridad en tiempo real.

---

### `idl2wrs`
Generador que convierte archivos **CORBA IDL (Interface Definition Language)** en plugins de Wireshark, para decodificar protocolos CORBA personalizados.

---

### `mergecap`
Combina dos o m√°s archivos de captura en uno solo.
Se asegura de que los paquetes queden ordenados cronol√≥gicamente si es necesario.
Ejemplo: unir capturas de varias interfaces.

---

### `mmdbresolve`
Lee direcciones **IPv4 e IPv6** y muestra informaci√≥n de **geolocalizaci√≥n IP** usando bases MaxMind (GeoLite2/GeoIP2).
Ejemplo: `echo 8.8.8.8 | mmdbresolve`

---

### `randpkt`
Generador de **paquetes de red aleatorios** con diferentes protocolos.
Muy √∫til para pruebas de robustez en analizadores de tr√°fico.

---

### `randpktdump`
Extcap que usa `randpkt` para generar **capturas aleatorias** en formato PCAP, simulando tr√°fico ficticio.

---

### `rawshark`
Versi√≥n en l√≠nea de comandos que procesa paquetes en crudo desde archivos o pipes.
Muestra informaci√≥n en texto plano (sin GUI), √∫til para scripting y automatizaci√≥n.

---

### `reordercap`
Reordena un archivo de captura seg√∫n las **marcas de tiempo** de los paquetes.
√ötil cuando los paquetes se grabaron fuera de orden (ej. varias fuentes de captura).

---

### `sshdig`
Extcap que captura **llamadas al sistema** desde un host remoto a trav√©s de SSH (usando un binario de captura remoto).
Enfocado en an√°lisis de seguridad y debugging.

---

### `sshdump`
Similar a `ciscodump`, permite capturar tr√°fico desde un **host remoto v√≠a SSH**.
Soporta sistemas gen√©ricos (no solo Cisco). Muy usado para auditor√≠a.

---

### `stratoshark`
Analizador de **llamadas al sistema y registros de eventos**, orientado a correlacionar procesos del sistema con el tr√°fico capturado.

---

### `text2pcap`
Convierte un **hexdump ASCII** (copiado de logs, correos, debugging) en un archivo `.pcap` v√°lido.
√ötil para reconstruir tr√°fico a partir de registros textuales.

---

### `tshark`
Versi√≥n en l√≠nea de comandos de Wireshark.
Permite **capturar y analizar tr√°fico** sin interfaz gr√°fica.
Muy flexible: filtros, salida en JSON/CSV, integraci√≥n con scripts.

---

###  `udpdump`
Extcap que implementa un **receptor UDP**, utilizado para recibir tr√°fico exportado por dispositivos de red (ej. Aruba routers) y guardarlo en formato PCAP.

---

### `wifidump`
Extcap que habilita la captura de **tr√°fico Wi-Fi** desde un host remoto mediante SSH.
√ötil para auditor√≠as inal√°mbricas distribuidas.



## Ejemplo 

---

## Requisitos previos

1. Tener instalado **Wireshark** y su versi√≥n de l√≠nea de comandos **tshark**.

   * En Linux:

     ```bash
     sudo apt install wireshark
     ```
   * En macOS con brew:

     ```bash
     brew install wireshark
     ```
   * En Windows, tshark se incluye con la instalaci√≥n est√°ndar de Wireshark.

2. Saber el nombre de la interfaz de red que usar√°s (ejemplo: `eth0`, `wlan0`, `en0`).
   Listar interfaces disponibles:

   ```bash
   tshark -D
   ```

---

## Paso 1. Resolver la IP del dominio

Antes de filtrar tr√°fico, obtenemos la IP p√∫blica de `www.inegi.org.mx`:

```bash
nslookup www.inegi.org.mx
```

Ejemplo de salida:

```
Non-authoritative answer:
Name:    www.inegi.org.mx
Address: 187.141.67.17
```

Nota: Guardamos esta IP: `187.141.67.17` (puede variar).

---

##  Paso 2. Capturar tr√°fico con filtro

Ahora capturamos tr√°fico hacia/desde esa IP.

Ejemplo en Linux/macOS:

```bash
sudo tshark -i wlan0 host 187.141.67.17 -w inegi_capture.pcap
```

* `-i wlan0` ‚Üí interfaz de red (aj√∫stala seg√∫n tu equipo).
* `host 187.141.67.17` ‚Üí filtro BPF para capturar solo tr√°fico hacia ese host.
* `-w inegi_capture.pcap` ‚Üí guarda la captura en un archivo para an√°lisis posterior en Wireshark GUI.

---

## Paso 3. Ver tr√°fico en tiempo real

Si no quieres guardar, sino ver directamente en consola:

```bash
sudo tshark -i wlan0 -f "host 187.141.67.17"
```

Ejemplo de salida (resumida):

```
1   0.000000 192.168.1.20 ‚Üí 187.141.67.17 TCP 74 50412 ‚Üí 443 [SYN] Seq=0 Win=65535 Len=0 MSS=1460
2   0.123456 187.141.67.17 ‚Üí 192.168.1.20 TCP 74 443 ‚Üí 50412 [SYN, ACK] Seq=0 Ack=1 Win=65535 Len=0 MSS=1460
3   0.123789 192.168.1.20 ‚Üí 187.141.67.17 TCP 66 50412 ‚Üí 443 [ACK] Seq=1 Ack=1 Win=65535 Len=0
4   0.234567 192.168.1.20 ‚Üí 187.141.67.17 TLSv1.3 517 Client Hello
...
```

---

## Paso 4. Filtrar por protocolo (ejemplo HTTPS)

Ya que `www.inegi.org.mx` usa HTTPS (puerto 443), podemos ver solo paquetes de TLS:

```bash
sudo tshark -i wlan0 -f "host 187.141.67.17 and port 443"
```

O dentro de la captura:

```bash
tshark -r inegi_capture.pcap -Y "tls"
```

Esto muestra √∫nicamente tr√°fico TLS (no DNS ni TCP crudo).

---

## Paso 5. Capturar y analizar consultas DNS al dominio

Si queremos ver c√≥mo se resuelve el dominio antes de la conexi√≥n:

```bash
sudo tshark -i wlan0 -f "port 53" -Y "dns.qry.name == \"www.inegi.org.mx\""
```

Ejemplo de salida:

```
10   1.123456 192.168.1.20 ‚Üí 8.8.8.8 DNS 78 Standard query 0x1234 A www.inegi.org.mx
11   1.234567 8.8.8.8 ‚Üí 192.168.1.20 DNS 94 Standard query response 0x1234 A 187.141.67.17
```

__________________________

Referencia

> https://www.wireshark.org/docs/
